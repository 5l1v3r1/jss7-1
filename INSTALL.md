Build Instructions
==================
This project contains both the original Maven `pom.xml`s and the new
`Makefile` and associated `build.mk` files.

This document describe how to use GNU `make` to build the release
package.

*NOTE*: Building the documentation and running the tests are
        unsupported -- use Maven for that.

Required Dependencies
---------------------
To compile the code, a number of JARs are required to be available in
the `libs` subdirectory:

* [java-getopt-1.0.14.jar][]
* [javolution-5.5.1.jar][]
* [jmxtools-1.2.1.jar][]
* [jreadline-0.17.jar][]
* [log4j-1.2.17.zip][]: the JAR (`log4j-1.2.17.jar`) is inside the ZIP
* [JBoss AS 5.1.0.GA][]: copy at least the following JARs from the
  `jboss-5.1.0.GA/lib` directory:
  * jboss-common-core.jar
  * jboss-dependency.jar
  * jboss-j2se.jar
  * jboss-kernel.jar
  * jboss-logging-spi.jar
  * jboss-mdr.jar
  * jboss-reflect.jar
  * jboss-system.jar
  * jboss-system-jmx.jar
  * jboss-xml-binding.jar

Create the `libs` directory under the main directory -- where the file
you are reading is located -- and copy all the above-mentioned JARs into
it (you may organize them into a hierachy of subdirectories, if you feel
like).
Different versions from the ones shown above may or may not work -- for
example, `jreadline-0.20` won't.

Optional Dependencies
---------------------
The Mobicents jSS7 support both Digium and Dialogic E1/T1 boards.

To enable support for them, the following drivers/libraries must be
installed:

* for Digium cards, the [DAHDI drivers][] (tested against version 2.9.1
  and 2.10.0)
* for Dialogic cards, the [DSI Development Package][] (compiled against
  version 6.6.1)

Again, different versions from the ones listed above may or may not
work.

*NOTE*: Digium support has been tested on real hardware, whereas
        Dialogic support _was not_.

Incremental Compilation
-----------------------
If the `jdeps` utility from OpenJDK 1.8 is available, incremental
compilation will be automatically enabled.
The benefit of incremental compilation is that when one or more
(re)source file is modified, only the minimum required
class/jar/whatever is rebuilt.
This is useful if you intend to work on the source.

However, for generating the list of dependencies may last for many
minutes (but only the first time, when a full compilation is performed),
if you only need to build it once, you may disable incremental
compilation creating a file named `localdefs.mk` in the main directory
-- where the `Makefile` is located -- containing the following text:

    HAVE_JDEPS = false

Alternatively, you may specify it in the `make` command line, e.g.:

    make HAVE_JDEPS=false

Native Libraries
----------------
For people may be interested only in the M3UA (SIGTRAN) transport layer
and for support for Digium and Dialogic cards requires additional
drivers/libraries, the support for Digium/Dialogic hardware is disabled
by default.

To enable it, create the file `localdefs.mk` (as described above) and
add to it:

    ENABLE_DAHDI = true

to enable support for Digium cards, and/or:

    ENABLE_DIALOGIC = true

to enable support for Dialogic cards.

Alternatively, you may add them to the `make` command line, e.g.:

    make ENABLE_DAHDI=true ENABLE_DIALOGIC=true package

If the Digium/Dialogic drivers are installed system-wide, the compiler
should be able to find the required include files and libraries.

If it fails, try adding the `CPPFLAGS` and `LDFLAGS` variables to the
`make` command line, e.g.:

    make "CPPFLAGS=-I/path/to/dpk/INC -I/path/to/dahdi/include"
         "LDFLAGS=-L/path/to/dpk/lib64 -L/path/to/dahdi/lib" package

Building
--------
To build everything, run:

    make package

This will build an archive named something like
`mobicents-ss7-2.1.0.FINAL-p1.tar.gz` inside the `packages` directory.

To compile only, run:

    make compile

or just:

    make

There is no install target, however the archive produced by `make
package` is (almost) identical to the one produced by Maven (except for
the documentation), i.e., you can execute the (un)install target
provided by the `build.xml` inside the archive (requires `ant`).

Other available targets are:

* `jars`, to build all the JARs and native libraries
* `clean`, to remove all the files generated by make
* `build/classes/some/path/to/package/SomeClass.class`, to compile only
  the specified class (or classes) -- useful to test changes made to
  SomeClass.java
* `build/resources/some-jarname/path/to/resource/ResourceName`, to
  process the specified resource file -- useful to verify the result of
  filtering

Every other target is for internal use only and should not be invoked
directly.


[java-getopt-1.0.14.jar]: http://www.urbanophile.com/arenn/hacking/getopt/java-getopt-1.0.14.jar
[javolution-5.5.1.jar]: http://download.java.net/maven/2/javolution/javolution/5.5.1/javolution-5.5.1.jar
[jmxtools-1.2.1.jar]: http://simile.mit.edu/maven/com/sun/jdmk/jmxtools/1.2.1/jmxtools-1.2.1.jar
[jreadline-0.17.jar]: https://repository.jboss.org/nexus/content/repositories/releases/org/jboss/jreadline/jreadline/0.17/jreadline-0.17.jar
[log4j-1.2.17.jar]: http://www.eu.apache.org/dist/logging/log4j/1.2.17/log4j-1.2.17.zip
[JBoss AS 5.1.0.GA]: http://sourceforge.net/projects/jboss/files/JBoss/JBoss-5.1.0.GA/jboss-5.1.0.GA.zip/download
[DAHDI drivers]: http://downloads.asterisk.org/pub/telephony/dahdi-linux-complete/dahdi-linux-complete-2.10.0+2.10.0.tar.gz
[DSI Development Package]: http://www.dialogic.com/en/products/signaling-and-ss7-components/download/dsi-network-interface-boards.aspx
